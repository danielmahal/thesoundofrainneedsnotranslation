<html>
	<head>
		<title>evolution</title>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,600,300italic,300,400italic,600italic,700,700italic,800,800italic' rel='stylesheet' type='text/css'>
		<style>
			body { margin: 0; font-family: "Open Sans" }
			canvas { display: block; width: 100%; height: 100%; }
			.content {
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
			}
		</style>
	</head>
	<body>
		<div class="content">
			<iframe id="player" width="500" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/267213251&amp;auto_play=true&amp;hide_related=false&amp;show_comments=true&amp;show_user=true&amp;show_reposts=false&amp;visual=true"></iframe>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r78/three.min.js"></script>
    <script src="noise.js"></script>
		<script src="https://w.soundcloud.com/player/api.js" type="text/javascript"></script>
		<script>
			var widgetIframe = document.getElementById('player'),
					widget       = SC.Widget(widgetIframe);

			widget.bind(SC.Widget.Events.READY, function() {
				widget.bind(SC.Widget.Events.PLAY_PROGRESS, function() {
					widget.getPosition(position => console.log(position))
					// // get information about currently playing sound
					// widget.getCurrentSound(function(currentSound) {
					// 	console.log('sound ' + currentSound.get('') + 'began to play');
					// });
				});
				// get current level of volume
				widget.getVolume(function(volume) {
					console.log('current volume value is ' + volume);
				});
				// set new volume level
				widget.setVolume(50);
				// get the value of the current position
			});

			const scene = new THREE.Scene()
			const camera = new THREE.PerspectiveCamera(90, window.innerWidth / window.innerHeight, 0.1, 10)

			const renderer = new THREE.WebGLRenderer({
				antialias: true
			})

      const textureLoader = new THREE.TextureLoader()

			document.body.appendChild(renderer.domElement)

      const center = new THREE.Vector3(0, 0, 0)

			camera.position.z = 0.01
      camera.lookAt(center)

      const particleGeometry = new THREE.BufferGeometry()
      const particleMaterial = new THREE.PointsMaterial({
        color: 0xFFFFFF,
        size: 0.003
      })

			const count = 1000000

			const vertices = new Float32Array(count * 3)

      textureLoader.load('circle-512.png', texture => {
        particleMaterial.map = texture
        particleMaterial.needsUpdate = true
      })

      for (let i = 0; i < count; i += 3) {
				const particle = new THREE.Vector3(
          Math.random() - 0.5,
          Math.random() - 0.5,
          Math.random() - 0.5
        ).setLength(Math.random() * 3 + 0.5)

        vertices[i] = particle.x
				vertices[i + 1] = particle.y
				vertices[i + 2] = particle.z
      }

			particleGeometry.addAttribute('position', new THREE.BufferAttribute(vertices, 3));

      const particles = new THREE.Points(particleGeometry, particleMaterial)

      scene.add(particles)

      scene.fog = new THREE.FogExp2(0x000000, 0.2);

			function render(time=0) {
				requestAnimationFrame(render)

				particles.rotation.y += 0.0001
				particles.rotation.x += 0.00012

				renderer.render(scene, camera)
			}

      function mouseMove(e) {
        center.x = (e.clientX / window.innerWidth) - 0.5
        center.y = (e.clientY / window.innerHeight) - 0.5
      }

      function resize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight)
      }

      window.addEventListener('resize', resize)

			// document.body.addEventListener('click', () => {
			// 	document.documentElement.webkitRequestFullscreen()
			// })

      resize()
      render()
		</script>
	</body>
</html>
